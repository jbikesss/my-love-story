<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Our Story</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@400;600&family=Caveat&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
    <style>
        /* CSS AREA (STYLE)*/
:root {
    --pink: #f8bbd0;
    --dark-pink: #f06292;
    --purple: #ce93d8;
    --white: #ffffff;
}

body {
    margin: 0; font-family: 'Quicksand', sans-serif;
    background: linear-gradient(135deg, #fce4ec 0%, #f3e5f5 100%);
    overflow-x: hidden;
}

.overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: var(--white); z-index: 2000;
    display: flex; justify-content: center; align-items: center;
}

.background-animation { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
.heart { position: absolute; color: var(--pink); animation: float 6s infinite linear; }
@keyframes float { 0% { transform: translateY(110vh); opacity: 1; } 100% { transform: translateY(-10vh); opacity: 0; } }

h1, h2 { font-family: 'Dancing Script', cursive; color: var(--dark-pink); font-size: 3rem; }
.container { padding: 60px 20px; text-align: center; max-width: 1100px; margin: auto; }

/* Horizontal Scrolling Logic (Shared for Photos and Voice) */
.photo-wrapper, .voice-wrapper { 
    width: 100%; overflow-x: auto; padding: 20px 0; 
    scrollbar-width: thin; scrollbar-color: var(--dark-pink) transparent;
}
.photo-grid, .voice-scroll-grid { display: flex; gap: 30px; width: max-content; }

/* Photo Card */
.photo-card img {
    width: 280px; height: 380px; object-fit: cover;
    border: 8px solid white; border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.1);
}

/* Video Styling */
.video-grid { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; }
.video-card { background: white; padding: 15px; border-radius: 20px; width: 320px; box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
.romantic-video { width: 100%; border-radius: 10px; }

/* Voice Card Scrolling */
.voice-card {
    width: 260px; background: white; padding: 20px; border-radius: 20px; 
    box-shadow: 0 10px 20px rgba(0,0,0,0.05); flex: 0 0 auto;
}

/* Waveform Animation */
.waveform { display: flex; gap: 4px; height: 40px; justify-content: center; align-items: center; margin-bottom: 15px; }
.waveform span { width: 6px; height: 15px; background: var(--dark-pink); border-radius: 10px; }
.waveform.playing span { animation: wave 0.8s infinite ease-in-out; }
.waveform.playing span:nth-child(2) { animation-delay: 0.1s; }
.waveform.playing span:nth-child(3) { animation-delay: 0.2s; }
@keyframes wave { 0%, 100% { height: 15px; } 50% { height: 40px; } }

/* Shared Button Styles */
.btn-main, .btn-heart, .btn-voice {
    background: var(--dark-pink); color: white; border: none; padding: 10px 25px;
    border-radius: 25px; cursor: pointer; transition: 0.3s;
}
.btn-voice { background: var(--purple); }
.btn-main:hover, .btn-voice:hover { transform: scale(1.05); opacity: 0.9; }

.hero { height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; }
.letter-card { background: white; padding: 20px; margin: 10px auto; max-width: 600px; border-radius: 10px; font-family: 'Caveat'; font-size: 1.5rem; }

/* Bouquet Section */
.bouquet-section {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    background: radial-gradient(circle, #fff5f8 0%, #fce4ec 100%);
}

.bouquet-container {
    position: relative;
    height: 400px;
    width: 300px;
    margin-top: 50px;
}

/* The Tulip Structure */
.tulip {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform-origin: bottom center;
}

.stem {
    width: 6px;
    height: 200px;
    background: #81c784;
    border-radius: 10px;
}

.flower {
    width: 50px;
    height: 60px;
    background: #f48fb1; /* Pink Tulip Color */
    border-radius: 50% 50% 50% 50% / 80% 80% 20% 20%;
    position: absolute;
    top: -55px;
    left: -22px;
    box-shadow: inset -10px -10px 20px rgba(0,0,0,0.1);
    animation: bloom 3s infinite ease-in-out;
}

/* Complex Petal Details */
.flower::before, .flower::after {
    content: '';
    position: absolute;
    background: #f06292;
    width: 100%;
    height: 100%;
    border-radius: inherit;
    transform-origin: bottom center;
}

.flower::before { transform: rotate(-15deg); opacity: 0.8; }
.flower::after { transform: rotate(15deg); opacity: 0.8; }

/* Individual Tulip Placements & Swaying */
.t1 { transform: translateX(-60px) rotate(-20deg); animation: sway 4s infinite ease-in-out; }
.t2 { transform: translateX(-30px) rotate(-10deg); animation: sway 5s infinite ease-in-out 0.5s; }
.t3 { transform: translateX(0px) rotate(0deg); animation: sway 3.5s infinite ease-in-out 1s; }
.t4 { transform: translateX(30px) rotate(10deg); animation: sway 4.5s infinite ease-in-out 0.2s; }
.t5 { transform: translateX(60px) rotate(20deg); animation: sway 3.8s infinite ease-in-out 0.7s; }

/* Animations */
@keyframes sway {
    0%, 100% { transform: translateX(var(--x)) rotate(var(--r)); }
    50% { transform: translateX(var(--x)) rotate(calc(var(--r) + 5deg)); }
}

/* Re-defining the sway for each to keep their base position */
.t1 { --x: -60px; --r: -20deg; }
.t2 { --x: -30px; --r: -10deg; }
.t3 { --x: 0px; --r: 0deg; }
.t4 { --x: 30px; --r: 10deg; }
.t5 { --x: 60px; --r: 20deg; }

@keyframes bloom {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

/* Ribbon */
.ribbon {
    position: absolute;
    bottom: 50px;
    left: 50%;
    transform: translateX(-50%);
    width: 100px;
    height: 40px;
    background: #ce93d8;
    border-radius: 20px;
    z-index: 10;
}

.ribbon::after {
    content: '‚ù§Ô∏è';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 1.2rem;
}

.gift-text {
    margin-top: 40px;
    font-family: 'Caveat', cursive;
    font-size: 2rem;
    color: var(--dark-pink);
}
/* Paradise Container */
.world-bg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to top, #e2f9e1 15%, #fdf2f8 100%);
    z-index: 1;
}

.cute-house {
    position: absolute;
    bottom: 15%;
    right: 10%;
    font-size: clamp(9rem, 19vw, 12rem);
    filter: drop-shadow(5px 5px 0px #ffc1e3);
    z-index: 2;
}

.tree { position: absolute; bottom: 13%; z-index: 2; }
.t-left { left: 5%; font-size: 7rem; }
.t-right { right: 5%; font-size: 6rem; }
.flower-patch { position: absolute; bottom: 13%; left: 25%; font-size: 1.5rem; opacity: 0.8; z-index: 2; }

/* Rabbit Sprite */
.rabbit-sprite {
    position: absolute;
    bottom: 13%;
    left: 50%;
    font-size: 5rem;
    z-index: 40;
    transition: transform 0.1s linear;
    pointer-events: none;
    transform-origin: bottom center;
}

/* Animations */
@keyframes waddle {
    0%, 100% { transform: rotate(-8deg) translateY(0); }
    50% { transform: rotate(8deg) translateY(-8px); }
}

@keyframes jump {
    0%, 100% { transform: translateY(0) scale(1, 1); }
    50% { transform: translateY(-60px) scale(0.9, 1.1); }
}

.waddling { animation: waddle 0.3s infinite; }
.jumping { animation: jump 0.4s ease-in-out infinite; }
        
        /* Make sure to copy everything from :root to the Tulip animations */
    </style>
</head>
<body>
    
    <div id="overlay" class="overlay">
        <div class="overlay-content">
            <h1>Ready for the surprise?</h1>
            <button onclick="startSite()" class="btn-main"> Open My Heart ‚ù§Ô∏è</button>
        </div>
    </div>

    <div class="background-animation"></div>

    <audio id="bgMusic" loop>
        <source src="static/images/Taylor_Swift_Lover.mp3" type="audio/mpeg">
    </audio>

    <header class="hero">
        <h1 data-aos="zoom-in">To My Dearest ‚ù§Ô∏è</h1>
        <p data-aos="fade-up">A simple valentine gift for you.</p>
        <button onclick="scrollToSection('gallery')" class="btn-heart">Explore</button>
    </header>

    <section id="gallery" class="container">
        <h2 data-aos="fade-right">Our Hidden Treasure</h2>
        <div class="photo-wrapper">
            <div class="photo-grid">
                <div class="photo-card" data-aos="fade-up">
                    <img src="static/images/photo1.jpg" onerror="this.src='https://via.placeholder.com/300x400?text=Your+Photo+1'">
                    <p>Where it began</p>
                </div>
                <div class="photo-card" data-aos="fade-up" data-aos-delay="100">
                    <img src="static/images/photo2.jpg" onerror="this.src='https://via.placeholder.com/300x400?text=Your+Photo+2'">
                    <p>The moment we first shared time</p>
                </div>
                <div class="photo-card" data-aos="fade-up" data-aos-delay="200">
                    <img src="static/images/photo3.jpg" onerror="this.src='https://via.placeholder.com/300x400?text=Your+Photo+3'">
                    <p>The first look of love</p>
                </div>
                <div class="photo-card" data-aos="fade-up" data-aos-delay="300">
                    <img src="static/images/photo4.jpg" onerror="this.src='https://via.placeholder.com/300x400?text=Your+Photo+4'">
                    <p>First stolen pic</p>
                </div>
                <div class="photo-card" data-aos="fade-up" data-aos-delay="400">
                    <img src="static/images/photo5.jpg" onerror="this.src='https://via.placeholder.com/300x400?text=Your+Photo+5'">
                    <p>First callsign</p>
                </div>
                <div class="photo-card" data-aos="fade-up" data-aos-delay="500">
                    <img src="static/images/photo6.jpg" onerror="this.src='https://via.placeholder.com/300x400?text=Your+Photo+6'">
                    <p>First Milktea with youu</p>
                </div>
                <div class="photo-card" data-aos="fade-up" data-aos-delay="600">
                    <img src="static/images/photo7.jpg" onerror="this.src='https://via.placeholder.com/300x400?text=Your+Photo+7'">
                    <p>First kerengkengg</p>
                </div>
                <div class="photo-card" data-aos="fade-up" data-aos-delay="700">
                    <img src="static/images/photo8.jpg" onerror="this.src='https://via.placeholder.com/300x400?text=Your+Photo+8'">
                    <p>My First Date</p>
                </div>
                <div class="photo-card" data-aos="fade-up" data-aos-delay="800">
                    <img src="static/images/photo9.jpg" onerror="this.src='https://via.placeholder.com/300x400?text=Your+Photo+9'">
                    <p>A hold of Lovee</p>
                </div>
                <div class="photo-card" data-aos="fade-up" data-aos-delay="900">
                    <img src="static/images/photo10.jpg" onerror="this.src='https://via.placeholder.com/300x400?text=Your+Photo+10'">
                    <p>Bili iskulsuplay widyuu</p>
                </div>
                <div class="photo-card" data-aos="fade-up" data-aos-delay="1000">
                    <img src="static/images/photo11.jpg" onerror="this.src='https://via.placeholder.com/300x400?text=Your+Photo+11'">
                    <p>Baby Time</p>
                </div>
                <div class="photo-card" data-aos="fade-up" data-aos-delay="1100">
                    <img src="static/images/photo12.jpg" onerror="this.src='https://via.placeholder.com/300x400?text=Your+Photo+12'">
                    <p>Another baby time</p>
                </div>
                <div class="photo-card" data-aos="fade-up" data-aos-delay="1200">
                    <img src="static/images/photo13.jpg" onerror="this.src='https://via.placeholder.com/300x400?text=Your+Photo+13'">
                    <p>Unplaned visit to my baby</p>
                </div>
                <div class="photo-card" data-aos="fade-up" data-aos-delay="1300">
                    <img src="static/images/photo14.jpg" onerror="this.src='https://via.placeholder.com/300x400?text=Your+Photo+14'">
                    <p>My Pahingaa</p>
                </div>
                <div class="photo-card" data-aos="fade-up" data-aos-delay="1400">
                    <img src="static/images/photo15.jpg" onerror="this.src='https://via.placeholder.com/300x400?text=Your+Photo+15'">
                    <p>My Christmas Gift</p>
                </div>
                <div class="photo-card" data-aos="fade-up" data-aos-delay="1500">
                    <img src="static/images/photo16.jpg" onerror="this.src='https://via.placeholder.com/300x400?text=Your+Photo+16'">
                    <p>Double Date</p>
                </div>
                <div class="photo-card" data-aos="fade-up" data-aos-delay="1600">
                    <img src="static/images/photo17.jpg" onerror="this.src='https://via.placeholder.com/300x400?text=Your+Photo+17'">
                    <p>Gan'to tayo ka-Close</p>
                </div>
                <div class="photo-card" data-aos="fade-up" data-aos-delay="1700">
                    <img src="static/images/photo18.jpg" onerror="this.src='https://via.placeholder.com/300x400?text=Your+Photo+18'">
                    <p>4k wallpaper widmababy</p>
                </div>
                <div class="photo-card" data-aos="fade-up" data-aos-delay="1800">
                    <img src="static/images/photo19.jpg" onerror="this.src='https://via.placeholder.com/300x400?text=Your+Photo+19'">
                    <p>My First Ever Bouquet</p>
                </div>
                <div class="photo-card" data-aos="fade-up" data-aos-delay="1900">
                    <img src="static/images/photo20.jpg" onerror="this.src='https://via.placeholder.com/300x400?text=Your+Photo+20'">
                    <p>Being so proud to my love</p>
                </div>
            </div>
        </div>
    </section>

    <section id="video-memories" class="container">
        <h2 data-aos="fade-up">Our Sweetest Moment</h2>
        <div class="video-grid">
            <div class="video-card" data-aos="zoom-in">
                <video autoplay muted loop playsinline class="romantic-video">
                    <source src="static/images/video1.mp4" type="video/mp4">
                </video>
                <p class="caption">My favorite memory üé•</p>
            </div>
        </div>
    </section>

    <section id="voice-memories" class="container">
        <h2 data-aos="fade-right">My secret voice message</h2>
        <div class="voice-wrapper">
            <div class="voice-scroll-grid">
                <div class="voice-card" data-aos="fade-up">
                    <h3>Sakit ka lang, love ko to</h3>
                    <div class="waveform">
                        <span></span><span></span><span></span><span></span><span></span>
                    </div>
                    <audio class="voice-audio">
                        <source src="static/images/voice1.mp3" type="audio/mpeg">
                    </audio>
                    <button onclick="playVoice(this)" class="btn-voice">Play Message</button>
                </div>
                <div class="voice-card" data-aos="fade-up" data-aos-delay="100">
                    <h3>A confession</h3>
                    <div class="waveform">
                        <span></span><span></span><span></span><span></span><span></span>
                    </div>
                    <audio class="voice-audio">
                        <source src="static/images/voice2.mp3" type="audio/mpeg">
                    </audio>
                    <button onclick="playVoice(this)" class="btn-voice">Play Message</button>
                </div>
                <div class="voice-card" data-aos="fade-up" data-aos-delay="200">
                    <h3>Cause it's You and Me</h3>
                    <div class="waveform">
                        <span></span><span></span><span></span><span></span><span></span>
                    </div>
                    <audio class="voice-audio">
                        <source src="static/images/voice3.mp3" type="audio/mpeg">
                    </audio>
                    <button onclick="playVoice(this)" class="btn-voice">Play Message</button>
                </div>
                <div class="voice-card" data-aos="fade-up" data-aos-delay="300">
                    <h3>Sasagipin kitaa</h3>
                    <div class="waveform">
                        <span></span><span></span><span></span><span></span><span></span>
                    </div>
                    <audio class="voice-audio">
                        <source src="static/images/voice4.mp3" type="audio/mpeg">
                    </audio>
                    <button onclick="playVoice(this)" class="btn-voice">Play Message</button>
                </div>
                <div class="voice-card" data-aos="fade-up" data-aos-delay="400">
                    <h3>You're the song itself,"My Iris"</h3>
                    <div class="waveform">
                        <span></span><span></span><span></span><span></span><span></span>
                    </div>
                    <audio class="voice-audio">
                        <source src="static/images/voice5.mp3" type="audio/mpeg">
                    </audio>
                    <button onclick="playVoice(this)" class="btn-voice">Play Message</button>
                </div>
                <div class="voice-card" data-aos="fade-up" data-aos-delay="500">
                    <h3>Ikaw at ako:)</h3>
                    <div class="waveform">
                        <span></span><span></span><span></span><span></span><span></span>
                    </div>
                    <audio class="voice-audio">
                        <source src="static/images/voice6.mp3" type="audio/mpeg">
                    </audio>
                    <button onclick="playVoice(this)" class="btn-voice">Play Message</button>
                </div>
                <div class="voice-card" data-aos="fade-up" data-aos-delay="600">
                    <h3>Pa yakap plss</h3>
                    <div class="waveform">
                        <span></span><span></span><span></span><span></span><span></span>
                    </div>
                    <audio class="voice-audio">
                        <source src="static/images/voice7.mp3" type="audio/mpeg">
                    </audio>
                    <button onclick="playVoice(this)" class="btn-voice">Play Message</button>
                </div>
                <div class="voice-card" data-aos="fade-up" data-aos-delay="700">
                    <h3>Torete akoo, oo</h3>
                    <div class="waveform">
                        <span></span><span></span><span></span><span></span><span></span>
                    </div>
                    <audio class="voice-audio">
                        <source src="static/images/voice8.mp3" type="audio/mpeg">
                    </audio>
                    <button onclick="playVoice(this)" class="btn-voice">Play Message</button>
                </div>
                <div class="voice-card" data-aos="fade-up" data-aos-delay="700">
                    <h3>I'm incomplete</h3>
                    <div class="waveform">
                        <span></span><span></span><span></span><span></span><span></span>
                    </div>
                    <audio class="voice-audio">
                        <source src="static/images/voice9.mp3" type="audio/mpeg">
                    </audio>
                    <button onclick="playVoice(this)" class="btn-voice">Play Message</button>
                </div>
            </div>
        </div>
    </section>

    <section id="letters" class="container">
        <h2 data-aos="fade-up">Hi Danica!</h2>
        <div class="letter-list">
            
            <div class="letter-card" data-aos="fade-up">
                <p>I hope you like this simple website I developed...ito na pala yung natutunan ko sa computer engineering hehehe...so ayunn Happy Valentines Day Danica..I wish you were happy right now and nasa maayos na kalagayan, walang sakit, mapayapa at di stress..I didn't make this just to bother youu, I made this because I want too..I didn't expect anything, It is just a gift for you... Please be happy and safe always haa... I'll pray for youu:) ‚ù§Ô∏è</p>
                <span>- From lambottt</span>
            </div>
        </div>
    </section>

    <section id="the-gift" class="container bouquet-section">
    <h2 data-aos="zoom-in">Happy valentines poüå∏</h2>
    <div class="bouquet-container">
        <div class="bouquet">
            <div class="tulip t1">
                <div class="leaf"></div>
                <div class="stem"></div>
                <div class="flower"></div>
            </div>
            <div class="tulip t2">
                <div class="leaf"></div>
                <div class="stem"></div>
                <div class="flower"></div>
            </div>
            <div class="tulip t3">
                <div class="leaf"></div>
                <div class="stem"></div>
                <div class="flower"></div>
            </div>
            <div class="tulip t4">
                <div class="leaf"></div>
                <div class="stem"></div>
                <div class="flower"></div>
            </div>
            <div class="tulip t5">
                <div class="leaf"></div>
                <div class="stem"></div>
                <div class="flower"></div>
            </div>
            <div class="ribbon"></div>
        </div>
    </div>
    <p class="gift-text" data-aos="fade-up">These tulips will never fade, just like my memorries with you.</p>
    </section>

    <section id="rabbit-paradise" class="container" style="min-height: 100vh; position: relative; overflow: hidden; background: #fdf2f8; padding: 0;">
    <h2 data-aos="fade-up" style="position: relative; z-index: 30; margin-top: 50px;">The Bunny Again :)) </h2>
    
    <div class="world-bg">
        <div class="cute-house">üè°</div>
        <div class="tree t-left">üå≥</div>
        <div class="tree t-right">üå≥</div>
        <div class="flower-patch">üåπüåªü™¥üå∑</div>
    </div>

    <canvas id="particleCanvas" style="position: absolute; top: 0; left: 0; z-index: 10; cursor: crosshair;"></canvas>

    <div id="rabbit" class="rabbit-sprite">üêá</div>

    <p style="position: absolute; bottom: 30px; width: 100%; text-align: center; color: #db2777; font-family: 'Caveat'; font-size: 1.6rem; z-index: 30; pointer-events: none;">
        Hold the screen to pull my heart..
    </p>
    </section>
    
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script>
        // JAVASCRIPT LOGIC AREA
AOS.init({ duration: 1000 });
const music = document.getElementById('bgMusic');

function startSite() {
    document.getElementById('overlay').style.display = 'none';
    music.play();
}

function scrollToSection(id) {
    document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
}

// Logic for multiple Voice Notes
function playVoice(btn) {
    const card = btn.parentElement;
    const audio = card.querySelector('.voice-audio');
    const wave = card.querySelector('.waveform');

    // Pause all other audio first
    document.querySelectorAll('.voice-audio').forEach(a => {
        if (a !== audio) {
            a.pause();
            a.parentElement.querySelector('.waveform').classList.remove('playing');
            a.parentElement.querySelector('.btn-voice').innerText = "Play Message";
        }
    });

    if (audio.paused) {
        audio.play();
        wave.classList.add('playing');
        btn.innerText = "Pause";
        music.volume = 0.1;
    } else {
        audio.pause();
        wave.classList.remove('playing');
        btn.innerText = "Play Message";
        music.volume = 1.0;
    }

    audio.onended = () => {
        wave.classList.remove('playing');
        btn.innerText = "Play Message";
        music.volume = 1.0;
    };
}

// Heart Particles
function createHeart() {
    const heart = document.createElement('div');
    heart.classList.add('heart');
    heart.innerHTML = '‚ù§Ô∏è';
    heart.style.left = Math.random() * 100 + 'vw';
    heart.style.animationDuration = (Math.random() * 2 + 3) + 's';
    document.querySelector('.background-animation').appendChild(heart);
    setTimeout(() => heart.remove(), 5000);
}
setInterval(createHeart, 600);

function sendLetter() {
            const sender = document.getElementById('senderName').value;
            const message = document.getElementById('loveMessage').value;
            if(!message) return;
            
            const list = document.getElementById('letterList');
            const newLetter = `<div class="letter-card"><p>"${message}"</p><span>- From ${sender}</span></div>`;
            list.innerHTML += newLetter;
            
            // Save to browser memory
            localStorage.setItem('savedLetters', list.innerHTML);
        }

// Sparkle hearts when viewing the gift
window.onscroll = function() {
    if ((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 100) {
        // We are at the bottom! Let's burst hearts.
        for(let i=0; i<5; i++) {
            setTimeout(createHeart, i * 100);
        }
    }
}
// --- CONFIGURATION ---
const canvas = document.getElementById('particleCanvas');
const ctx = canvas.getContext('2d');
const rabbitEl = document.getElementById('rabbit');

let particles = [];
let isMouseDown = false;
const mouse = { x: 0, y: 0 };
const particleCount = 1000;

// Rabbit State
let rabbitPos = { x: window.innerWidth / 2 };
let rabbitTargetX = rabbitPos.x;
let rabbitState = 'idle';

// --- INITIALIZATION ---
function initWorld() {
    canvas.width = canvas.parentElement.clientWidth;
    canvas.height = canvas.parentElement.clientHeight;
    
    particles = [];
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 3.5; // Positions heart in the upper half
    const scale = Math.min(canvas.width, canvas.height) / 40;

    for (let i = 0; i < particleCount; i++) {
        const t = (i / particleCount) * Math.PI * 2;
        // Heart Math Equation
        const x = 16 * Math.pow(Math.sin(t), 3);
        const y = -(13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t));
        
        particles.push(new Particle(centerX + x * scale, centerY + y * scale));
    }
}

// --- PARTICLE CLASS ---
class Particle {
    constructor(x, y) {
        this.homeX = x;
        this.homeY = y;
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.vx = (Math.random() - 0.5) * 10;
        this.vy = (Math.random() - 0.5) * 10;
        this.radius = Math.random() * 2.5 + 1;
        this.color = `rgba(240, 98, 146, ${Math.random() * 0.6 + 0.4})`;
    }

    draw() {
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fill();
    }

    update() {
        if (isMouseDown) {
            let dx = mouse.x - this.x;
            let dy = mouse.y - this.y;
            let dist = Math.sqrt(dx * dx + dy * dy);
            let force = dist / 2000;
            this.vx += dx * force;
            this.vy += dy * force;
        } else {
            let dx = this.homeX - this.x;
            let dy = this.homeY - this.y;
            this.vx += dx * 0.03;
            this.vy += dy * 0.03;
        }

        this.vx *= 0.92; // Friction
        this.vy *= 0.92;
        this.x += this.vx;
        this.y += this.vy;
    }

    explode() {
        const angle = Math.random() * Math.PI * 2;
        const speed = Math.random() * 12 + 4;
        this.vx = Math.cos(angle) * speed;
        this.vy = Math.sin(angle) * speed;
    }
}

// --- RABBIT AI ---
function updateRabbit() {
    if (isMouseDown) {
        rabbitState = 'idle';
        rabbitEl.classList.remove('waddling');
    } else if (rabbitState === 'walking') {
        let dist = rabbitTargetX - rabbitPos.x;
        if (Math.abs(dist) > 5) {
            rabbitPos.x += dist > 0 ? 2.5 : -2.5;
            rabbitEl.style.left = rabbitPos.x + 'px';
            rabbitEl.style.transform = dist > 0 ? 'scaleX(-1)' : 'scaleX(1)';
            rabbitEl.classList.add('waddling');
        } else {
            rabbitState = 'idle';
            rabbitEl.classList.remove('waddling');
        }
    } else {
        if (Math.random() < 0.015) { // Chance to move
            rabbitTargetX = Math.random() * (window.innerWidth - 100) + 50;
            rabbitState = 'walking';
        }
    }
}

// --- MAIN LOOP ---
function render() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    particles.forEach(p => {
        p.update();
        p.draw();
    });
    updateRabbit();
    requestAnimationFrame(render);
}

// --- EVENTS ---
const updateMouse = (e) => {
    const rect = canvas.getBoundingClientRect();
    mouse.x = (e.clientX || e.touches[0].clientX) - rect.left;
    mouse.y = (e.clientY || e.touches[0].clientY) - rect.top;
};

canvas.addEventListener('mousedown', (e) => { isMouseDown = true; updateMouse(e); });
canvas.addEventListener('mousemove', (e) => { if(isMouseDown) updateMouse(e); });
window.addEventListener('mouseup', () => {
    if(isMouseDown) {
        isMouseDown = false;
        particles.forEach(p => p.explode());
        rabbitEl.classList.add('jumping');
        setTimeout(() => rabbitEl.classList.remove('jumping'), 1200);
    }
});

// Mobile support
canvas.addEventListener('touchstart', (e) => { isMouseDown = true; updateMouse(e); });
canvas.addEventListener('touchmove', (e) => { if(isMouseDown) updateMouse(e); });

window.addEventListener('resize', initWorld);
initWorld();
render();
        
    </script>
</body>
</html>
